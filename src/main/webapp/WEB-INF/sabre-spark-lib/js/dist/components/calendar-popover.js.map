{"version":3,"sources":["components/calendar-popover.js"],"names":["noop","domDateFormat","parsedDomFormat","createDefaultElement","el","document","createElement","className","innerHTML","parseInitParams","params","hasOwnProperty","els","HTMLElement","visibleCounts","visibleCount","mins","min","maxes","max","values","value","CalendarPopover","calendarEl","_createCalendar","call","_cacheCalendarElements","_bindEventListenerCallbacks","_addEventListeners","_initDatesToShow","update","_removeEventListeners","Array","_cacheElements","_parseInputElsParams","activeIndex","render","_checkSize","open","index","_isDisabled","_unfillToggle","_deactivateElement","clearTimeout","_openCloseTimer","popover","_createPopover","updateValues","clearCache","setTimeout","affixTo","querySelector","bind","delay","_activateElement","close","getValue","setValue","skipRangeCheck","obj","getValues","inputEls","indexOf","_checkValues","getString","_inputsChanging","push","onChange","pos","splice","clearValues","i","len","length","clearValue","Error","updateValue","disable","undefined","toggle","setAttribute","enable","removeAttribute","content","_renderCache","viewRange","_renderYears","_renderWeeks","_renderDays","_renderMonths","_insertContent","_updateAttributes","remove","leaveElement","next","_atMax","_setDatesToShow","append","previous","_atMin","prepend","showDate","month","year","day","showing","_datesToShow","clone","noun","charAt","toUpperCase","slice","months","current","now","_renderMonth","date","key","html","_getMonthClassNames","quickJump","_renderMonthQuickJump","monthName","_renderMonthDaysOfWeek","_renderMonthDays","years","quickJumpRange","monthOpts","getMonthNames","map","val","text","filter","appendChild","selected","attributes","class","name","options","daysOfWeek","getDayNames","str","dayOfWeek","monthStart","startOfWeek","weekStart","monthEnd","weeks","j","isCurrentMonth","inactive","_renderMonthDay","create","disabled","_isDayDisabled","_isDaySelected","_isDayRangeStart","_isDayRangeMiddle","_isDayRangeEnd","_isDayRangeLast","_getDayInfo","_currentContent","keep","animate","_animateContent","animationDuration","unshift","calendarContentEl","equal","daysDisabled","before","after","daysInfo","cls","equalMonth","_isRange","start","end","middle","valBefore","afterMonth","valAfter","beforeMonth","afterEnd","join","calendarOverflowEl","anchorX","anchorY","contentEl","onClose","_onPopoverClose","onOpen","_onPopoverOpen","input","nodeName","toLowerCase","nextButtonEl","previousButtonEl","_parseParams","autoAdvance","autoClose","closeDelay","showOnFocus","disableds","getAttribute","parseInt","minVisible","earliest","maxVisible","latest","arr","change","_currentBreakpoint","_checkMinDateVisible","_checkMaxDateVisible","addDate","lastSelected","action","_updateNav","setIndex","changed","_checkMinMaxValues","beforeDay","cb","duration","_animationQueue","d","_runAnimation","_animationTimer","a","shift","_onInputChangeBound","_onInputChange","_onSelectChangeBound","_onSelectChange","_onInputFocusBound","_onInputFocus","_onClickBound","_onClick","_onCalendarClickBound","_onCalendarClick","_onCalendarMouseOverBound","_onCalendarMouseOver","_onCalendarMouseOutBound","_onCalendarMouseOut","_onResizeBound","_onResize","addEventListener","window","removeEventListener","_focusNext","_closeOnLast","_fillToggle","bp","outerWidth","_scrollToInput","_updateHoverClasses","hoverStarts","hoverEnds","_hoverStarts","_hoverEnds","allStarts","curStarts","newStarts","allEnds","curEnds","newEnds","forEach","prototype","concat","e","target","preventDefault","_onCalendarMouseOverMonths","mHasClass","c","newStart","newEnd","daySel","prevMonth","querySelectorAll","_onCalendarMouseOutMonths","days","nav","dir","stopPropagation","curVal","_whitelistedParams","defaults","_monthsShowing"],"mappings":"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","file":"calendar-popover.js","sourcesContent":["/**\n * # Calendar Popover\n * Create a calendar from which dates can be selected.\n *\n * @example\n * new CalendarPopover(el);\n *\n * @module components/calendar-popover.js\n */\nimport BaseComponent from './base';\nimport Popover from './popover';\nimport parseDateFormat from '../helpers/date/parse-format';\nimport dateHelper from '../helpers/date/date';\nimport buildSelect from '../helpers/form/build-select';\nimport addClass from '../helpers/dom/add-class';\nimport removeClass from '../helpers/dom/remove-class';\nimport hasClass from '../helpers/dom/has-class';\nimport appendChildren from '../helpers/manipulation/append-children';\nimport getParent from '../helpers/traversal/get-parent';\nimport triggerEvent from '../helpers/dom/trigger-event';\nimport {get as getBreakpoint} from '../helpers/dom/breakpoint';\nimport scrollWindowTo from '../helpers/animation/scroll-to';\nimport getSiblingBefore from '../helpers/traversal/get-sibling-before';\nimport getSiblingAfter from '../helpers/traversal/get-sibling-after';\nimport range from '../helpers/util/range';\nimport {number as parseNumberAttribute, boolean as parseBooleanAttribute, string as parseStringAttribute} from '../helpers/dom/parse-attribute';\n\nconst noop = function() {};\nconst domDateFormat = 'YYYY-MM-DD';\nconst parsedDomFormat = parseDateFormat(domDateFormat);\n\nfunction createDefaultElement() {\n  let el = document.createElement('span');\n  el.className = 'spark-input spark-date';\n  el.innerHTML = '<input class=\"spark-input__field\" type=\"date\"><span class=\"spark-label\"></span>';\n  return el;\n}\n\n/**\n * Parse the proper params for initialization\n * @param  {Element} el\n * @param  {Object} params\n * @return {Objec}\n */\nfunction parseInitParams(el, params) {\n\n  // If the first element is an array or array-like (NodeList),\n  // we will be working with a range.\n  if (el && el.hasOwnProperty('length')) {\n    params.els = el;\n  }\n  // If the first argument is a plain object, create a default element\n  // since the user MUST provide additional params but the element\n  // is optional. Doing it this way to keep the arity the same\n  // as other components.\n  else if (!(el instanceof HTMLElement)) {\n    params = el || {};\n    params.els = [createDefaultElement()];\n  }\n  // A single element is passed.\n  else {\n    params.els = [el];\n  }\n\n  params.visibleCounts = params.visibleCounts || (params.visibleCount ? [params.visibleCount] : null);\n  params.mins = params.mins || (params.min ? [params.min] : []);\n  params.maxes = params.maxes || (params.max ? [params.max] : []);\n  params.values = params.values || (params.value ? [params.value] : []);\n\n  return params;\n}\n\nclass CalendarPopover extends BaseComponent {\n\n  /**\n   * Calendar Popover constructor\n   * @param {Element} el Optional\n   * @param {Object} params Optional\n   */\n  constructor(el, params = {}) {\n\n    params = parseInitParams(el, params);\n\n    if (!super(el, params)) {\n      return;\n    }\n\n    // Create a calendar element if we weren't passed one.\n    (this.calendarEl ? noop : this._createCalendar).call(this);\n    this._cacheCalendarElements();\n\n    this._bindEventListenerCallbacks();\n    this._addEventListeners();\n    this._initDatesToShow();\n  }\n\n\n  /**\n   * Update the component to use a new element or reparse from\n   * the existing element.\n   * @param {Element} el Optional\n   */\n  update(el) {\n\n    if (el) {\n      this._removeEventListeners();\n      this.els = el instanceof Array ? el : [el];\n      this._cacheElements();\n      this._addEventListeners();\n    }\n\n    this._parseInputElsParams();\n    this._initDatesToShow();\n\n    if (this.activeIndex !== null) {\n      this.render();\n      this._checkSize();\n    }\n\n    return this;\n  }\n\n\n  /**\n   * Open the calendar widget.\n   * @param {Number} index Optional The index of the element to tie actions to\n   * @param {Object} params Optional\n   */\n  open(index = 0, params = {}) {\n\n    if (this._isDisabled[index]) {\n      return this;\n    }\n\n    this._unfillToggle();\n\n    // Allow for only params to be passed\n    if (typeof index === 'object') {\n      params = index;\n      index = 0;\n    }\n\n    // Already open\n    if (this.activeIndex === index) {\n      return this;\n    }\n\n    // We have an already active item, close it\n    if (this.activeIndex !== null) {\n      this._deactivateElement(this.activeIndex);\n    }\n\n    // Clear any timers which may be running to close or open this\n    clearTimeout(this._openCloseTimer);\n\n    // Set the new index\n    this.activeIndex = index;\n\n    // If we don't have a popover yet, create it.\n    if (!this.popover) {\n      this._createPopover();\n    }\n\n    // Get the list of dates to show for this view.\n    this._initDatesToShow();\n\n    // Ensure the cached values are in line with the input values.\n    this.updateValues();\n\n    // Create a calendar or calendars inside the popover\n    this.render({\n      clearCache: true\n    });\n\n    // Finally, show the popover after a delay or on the next tick.\n    this._openCloseTimer = setTimeout(function() {\n      this.popover.open({\n        affixTo: this.els[index].querySelector('.spark-date__calendar-toggle')\n      });\n    }.bind(this), params.delay || 0);\n\n    // Activate the corresponding element\n    this._activateElement(index);\n\n    return this;\n  }\n\n\n  /**\n   * Close the calendar widget.\n   * @param {Object} params\n   */\n  close(params) {\n\n    this._unfillToggle();\n\n    params = params || {};\n\n    // Can't close if we aren't or haven't yet opened.\n    if (this.activeIndex === null || !this.popover) {\n      return this;\n    }\n\n    // Deactive the corresponding element\n    this._deactivateElement(this.activeIndex);\n\n    // Clear any existing close or open events which are queued\n    clearTimeout(this._openCloseTimer);\n\n    // Close after a delay, or on the next tick\n    this.activeIndex = null;\n    this._openCloseTimer = setTimeout(function() {\n      this.popover.close();\n    }.bind(this), params.delay || 0);\n  }\n\n\n  /**\n   * Get the value.\n   * @param {Number|Element} index Optional\n   * @return {Mixed}\n   */\n  getValue(index) {\n    return this.values[index || 0];\n  }\n\n\n  /**\n   * Set the date for a given element.\n   * @param {String|Object} value\n   * @param {Number|Element} index\n   * @param {Boolean} skipRangeCheck Optional Don't check for sequential range values.\n   */\n  setValue(value, index, skipRangeCheck) {\n\n    let obj = typeof value === 'object' ? value : parsedDomFormat.getValues(value);\n    let el;\n\n    // If we are passed an element instead of an index, use that.\n    if (index instanceof HTMLElement) {\n      el = index;\n      index = this.inputEls.indexOf(el);\n    }\n    // Otherwise, find the element in our list.\n    else {\n      index = index || 0;\n      el = this.inputEls[index];\n    }\n\n    // Update the stored value\n    this.values[index] = obj;\n\n    // If we are working with a range, make sure that the values are in order.\n    if (value) {\n      this._checkValues(index, skipRangeCheck);\n    }\n\n    // Set the value on the input element. Make sure we don't get into an infinite\n    // loop since we listen to the change event on the input. We have to trigger it\n    // so that other components listening to it get the update.\n    el.value = value && obj === value ? parsedDomFormat.getString(value) : value || '';\n\n    this._inputsChanging = this._inputsChanging || [];\n    if (this._inputsChanging.indexOf(index) === -1) {\n      this._inputsChanging.push(index);\n\n      triggerEvent(el, 'change');\n      (this.onChange || noop)(el, el.value, this);\n\n      let pos = this._inputsChanging.indexOf(index);\n      this._inputsChanging.splice(pos, 1);\n    }\n\n    this.render({\n      clearCache: true\n    });\n\n    return this;\n  }\n\n\n  /**\n   * Clear the selected values.\n   */\n  clearValues() {\n\n    let els = this.inputEls;\n    let i = 0;\n    let len = els.length;\n\n    for (; i < len; i++) {\n      this.clearValue(i);\n    }\n\n    return this;\n  }\n\n\n  /**\n   * Clear the selected value.\n   * @param {Number} index\n   */\n  clearValue(index = 0) {\n    this.values = this.values || [];\n    if (!this.inputEls[index]) throw new Error(`Cannot clear value at index ${index}. No input element exists with that index!`);\n    this.values[index] = this.inputEls[index].value = null;\n    return this;\n  }\n\n\n  /**\n   * Take the date values from the inputs and set them as dates on the calendar.\n   */\n  updateValues() {\n\n    let els = this.inputEls;\n    let i = 0;\n    let len = els.length;\n\n    for (; i < len; i++) {\n      this.updateValue(i);\n    }\n\n    return this;\n  }\n\n\n  /**\n   * Take the date values from the inputs and set them as dates on the calendar.\n   * @param {Number} index\n   */\n  updateValue(index = 0) {\n    this.values = this.values || [];\n    if (!this.inputEls[index]) throw new Error(`Cannot update value at index ${index}. No input element exists with that index!`);\n    this.values[index] = this.inputEls[index].value ? parsedDomFormat.getValues(this.inputEls[index].value) : null;\n    return this;\n  }\n\n\n  /**\n   * Disable the calendar functionality.\n   * @param {Number} index\n   */\n  disable(index) {\n\n    let i = index || 0;\n    let len = index !== undefined ? index + 1 : this.els.length;\n    let toggle;\n\n    for(; i < len; i++) {\n      this._isDisabled[i] = true;\n      this.els[i].setAttribute('disabled', '');\n      toggle = this.els[i].querySelector('.spark-date__calendar-toggle');\n      if (toggle) toggle.setAttribute('disabled', '');\n    }\n\n    this.close();\n\n    return this;\n  }\n\n\n  /**\n   * Enable the calendar functionality.\n   * @param {Number} index\n   */\n  enable(index) {\n\n    let i = index || 0;\n    let len = index !== undefined ? index + 1 : this.els.length;\n    let toggle;\n\n    for(; i < len; i++) {\n      this._isDisabled[i] = false;\n      this.els[i].removeAttribute('disabled', '');\n      toggle = this.els[i].querySelector('.spark-date__calendar-toggle');\n      if (toggle) toggle.removeAttribute('disabled');\n    }\n\n    return this;\n  }\n\n\n  /**\n   * Render the calendar or calendars into the popover.\n   * @param {Object} params\n   */\n  render(params) {\n\n    params = params || {};\n\n    // If we don't have a popover yet, create it.\n    if (!this.popover) {\n      this._createPopover();\n    }\n\n    let content;\n\n    // Clear the cache so that we don't show out-of-date values.\n    if (params.clearCache) {\n      this._renderCache = {};\n    }\n\n    // Create the visible days, weeks, months or years\n    if (this.viewRange === 'year')\n      content = this._renderYears();\n    else if (this.viewRange === 'week')\n      content = this._renderWeeks();\n    else if (this.viewRange === 'day')\n      content = this._renderDays();\n    else\n      content = this._renderMonths();\n\n    this._insertContent(content, params);\n\n    // Update attributes\n    this._updateAttributes();\n\n    return this;\n  }\n\n\n  /**\n   * Cleans up event listeners and removes helpers.\n   * @param {Boolean} leaveElement Leave the element intact.\n   */\n  remove(leaveElement) {\n    this.popover && this.popover.remove();\n    return super.remove(leaveElement);\n  }\n\n\n  /**\n   * Move to the next set of dates.\n   */\n  next() {\n    if (this._atMax) return this;\n    this._setDatesToShow(1);\n    this.render({\n      append: 1\n    });\n    return this;\n  }\n\n\n  /**\n   * Move to the previous set of dates.\n   */\n  previous() {\n    if (this._atMin) return this;\n    this._setDatesToShow(-1);\n    this.render({\n      prepend: 1\n    });\n    return this;\n  }\n\n\n  /**\n   * Show a specific date on the calendar.\n   * @param {Object} params\n   */\n  showDate(params) {\n\n    // Open if we're closed.\n    if (this.activeIndex === null) {\n      this.open();\n    }\n\n    let month = params.month || null;\n    let year = params.year || null;\n    let day = params.day || null;\n\n    // Nothing to do.\n    if (!month && !year && !day) {\n      return this;\n    }\n\n    let showing = this._datesToShow[this.activeIndex].clone();\n    let noun = this.viewRange.charAt(0).toUpperCase() + this.viewRange.slice(1);\n\n    // Only change the values we were given\n    if (year) {\n      showing.year = year;\n    }\n    if (month) {\n      showing.month = month;\n    }\n    if (day) {\n      showing.day = day;\n    }\n\n    // Check min\n    let min = this.mins[this.activeIndex];\n    if (min && showing['before' + noun](min)) {\n      showing = min.clone();\n    }\n\n    // Check max\n    let max = this.maxes[this.activeIndex];\n    if (max && showing['after' + noun](max)) {\n      showing = max.clone();\n    }\n    this._datesToShow[this.activeIndex] = showing;\n\n    // Populate the rest of the dates\n    this._setDatesToShow();\n\n    return this.render();\n  }\n\n\n  /**\n   * Render the appropriate number of years.\n   * @return {Array}\n   */\n  _renderYears() {\n    throw new Error('Displaying years in the calendar is not yet supported!');\n  }\n\n\n  /**\n   * Render the appropriate number of weeks.\n   * @return {Array}\n   */\n  _renderWeeks() {\n    throw new Error('Displaying weeks in the calendar is not yet supported!');\n  }\n\n\n  /**\n   * Render the appropriate number of days.\n   * @return {Array}\n   */\n  _renderDays() {\n    throw new Error('Displaying days in the calendar is not yet supported!');\n  }\n\n\n  /**\n   * Render the appropriate number of months.\n   * @return {Array}\n   */\n  _renderMonths() {\n\n    let months = [];\n    let i = 0;\n    let len = this._datesToShow.length;\n    let current = dateHelper.now();\n\n    for (; i < len; i++) {\n      months.push(this._renderMonth(this._datesToShow[i], current));\n    }\n\n    return months;\n  }\n\n\n  /**\n   * Render a month.\n   * @param {Object} date\n   * @param {Object} current\n   * @return {Element}\n   */\n  _renderMonth(date, current) {\n\n    // A unique key for this month used for caching\n    let key = date.year + '-' + date.month;\n\n    // Ensure we have a cache\n    this._renderCache = this._renderCache || {};\n\n    // Return a cached instance\n    if (this._renderCache[key]) {\n      return this._renderCache[key];\n    }\n\n    // Create the element\n    let el = document.createElement('div');\n    let html = '';\n    el.className = 'spark-calendar__month ' + this._getMonthClassNames(date);\n\n    // Add the title or dropdowns.\n    html += '<div class=\"spark-calendar__month-title\">';\n    if (this.quickJump && this.visibleCounts[this.activeIndex] === 1) {\n      html += this._renderMonthQuickJump(date);\n    } else {\n      html += date.monthName + ' ' + date.year;\n    }\n    html += '</div>';\n\n    // Add the days of the week headings\n    html += this._renderMonthDaysOfWeek();\n\n    // Add the days\n    html += this._renderMonthDays(date, current);\n\n    el.innerHTML = html;\n\n    // Store in the cache and return\n    return (this._renderCache[key] = el);\n  }\n\n\n  /**\n   * Render the select inputs used for jumping ahead/backward several months.\n   * @param {Object} date\n   */\n  _renderMonthQuickJump(date) {\n\n    let el = document.createElement('div');\n    let years;\n    let months;\n\n    // Min and max year to show\n    let min = this.mins[this.activeIndex] ? this.mins[this.activeIndex].clone() : null;\n    let max = this.maxes[this.activeIndex] ? this.maxes[this.activeIndex].clone() : null;\n    let quickJumpRange = (typeof this.quickJumpRange === 'number' && (this.quickJumpRange % 1) === 0) ? this.quickJumpRange : 50;\n\n    // No min, go 50 years back\n    if (!min) {\n      min = date.clone();\n      min.year = min.year - quickJumpRange;\n    }\n\n    // No max, go 50 years forward\n    if (!max) {\n      max = date.clone();\n      max.year = max.year + quickJumpRange;\n    }\n\n    // Get the months to show.\n    let monthOpts = dateHelper.getMonthNames().map(function(val, i) {\n\n      // Don't show a month that is out of the valid range.\n      if (min.year === max.year && (i + 1 < min.month || i + 1 > max.month)) {\n        return null;\n      }\n\n      return {\n        value: i + 1,\n        text: val\n      };\n    }).filter(function(i) {\n      return i;\n    });\n\n\n    // Min and max are the same month, so just show text.\n    if (!monthOpts.length || monthOpts.length === 1) {\n      months = document.createElement('span');\n      months.innerHTML = date.monthName + ' ';\n    } else {\n\n      // Build a select list of months\n      months = document.createElement('label');\n      addClass(months, 'spark-select spark-calendar__select');\n      months.appendChild(buildSelect({\n        selected: date.month,\n        attributes: {\n          class: 'spark-select__input',\n          name: 'month'\n        },\n        options: monthOpts\n      }));\n    }\n\n    // Min and max year are the same, so just show text.\n    if (min.year === max.year) {\n      years = document.createElement('span');\n      years.innerHTML = date.year;\n    } else {\n\n      // Build a select list of years\n      years = document.createElement('label');\n      addClass(years, 'spark-select spark-calendar__select');\n      years.appendChild(buildSelect({\n        selected: date.year,\n        attributes: {\n          class: 'spark-select__input',\n          name: 'year'\n        },\n        options: range(max.year, min.year - 1)\n      }));\n    }\n\n    appendChildren(el, [months, years]);\n\n    return el.innerHTML;\n  }\n\n\n  /**\n   * Render the days of week row for a month calendar.\n   * @return {String}\n   */\n  _renderMonthDaysOfWeek() {\n\n    let daysOfWeek = dateHelper.getDayNames();\n    let i = 0;\n    let len = daysOfWeek.length;\n    let str = '<div class=\"spark-calendar__days-of-week\">';\n\n    for (; i < len; i++) {\n      str += '<span class=\"spark-calendar__day-of-week\">' + daysOfWeek[i][0] + '</span>';\n    }\n\n    return str += '</div>';\n  }\n\n\n  /**\n   * Render the days of week row for a month calendar.\n   * @param {Object} date\n   * @param {Object} current\n   * @return {String}\n   */\n  _renderMonthDays(date, current) {\n\n    let dayOfWeek = date.monthStart.dayOfWeek;\n    let startOfWeek = dayOfWeek > 1 ? date.monthStart.weekStart : null;\n    let monthEnd = date.monthEnd;\n    let weeks = 6;\n    let i = 0;\n    let j = 0;\n    let str = '<div class=\"spark-calendar__days\">';\n    let day = 0;\n    let month = startOfWeek ? startOfWeek.month : date.month;\n    let year = startOfWeek ? startOfWeek.year : date.year;\n    let isCurrentMonth = current.year === date.year && current.month === date.month;\n\n    // If we have days that come before the first of the month, the days will start as\n    // inactive. We use a 1 here to indicate the date is inactive and _before_\n    // the start of the month.\n    let inactive = startOfWeek ? 1 : null;\n\n    for (; i < weeks; i++) {\n      for (; j < 7; j++) {\n\n        day = startOfWeek ? startOfWeek.day + j : day + 1;\n        str += this._renderMonthDay(day, month, year, isCurrentMonth, current, inactive);\n\n        if (startOfWeek && j + 1 >= dayOfWeek - 1) {\n          startOfWeek = null;\n          inactive = null;\n          day = 0;\n          month = date.month;\n          year = date.year;\n          isCurrentMonth = current.year === date.year && current.month === date.month;\n        } else if (day >= monthEnd.day && i > 0) {\n\n          // Inactive days that come _after_ the last of the month are denoted with a 2.\n          // _renderMonthDay handles 1s and 2s differently, but both add the inactive class.\n          inactive = 2;\n          isCurrentMonth = false;\n\n          day = 0;\n          month++;\n\n          if (month > 12) {\n            year++;\n            month = 1;\n          }\n        }\n      }\n      j = 0;\n    }\n\n    return str += '</div>';\n  }\n\n\n  /**\n   * Render a day of the month.\n   * @param {Number} day\n   * @param {Number} month\n   * @param {Number} year\n   * @param {Boolean} isCurrentMonth\n   * @param {Object} current\n   * @param {Boolean} inactive\n   */\n  _renderMonthDay(day, month, year, isCurrentMonth, current, inactive) {\n\n    let date = dateHelper.create({\n      year: year,\n      month: month,\n      day: day\n    });\n    let str = '<a';\n    let disabled = inactive || this._isDayDisabled(date);\n\n    str += !disabled ? ' data-date=\"' + parsedDomFormat.getString(date) + '\"' : '';\n    str += inactive ? ' data-direction=\"' + (inactive === 2 ? 'next' : 'previous') + '\"' : '';\n    str += ' class=\"spark-calendar__day';\n    str += (isCurrentMonth && current.day === day && current.month === month && current.year === year ? ' spark-calendar__day--today' : '');\n    str += (inactive ? ' spark-calendar__day--inactive' : '');\n    str += (disabled ? ' spark-calendar__day--disabled' : '');\n    str += (this._isDaySelected(date) ? ' spark-calendar__day--selected' : '');\n    str += (this._isDayRangeStart(date) ? ' spark-calendar__range-start' : '');\n    str += (this._isDayRangeMiddle(date) ? ' spark-calendar__range-middle' : '');\n    str += (this._isDayRangeEnd(date) ? ' spark-calendar__range-end' : '');\n    str += (this._isDayRangeLast(date) ? ' spark-calendar__range-last' : '');\n    str += '\"';\n    str += ' href=\"#\"><span>';\n    str += day;\n    str += this._getDayInfo(date);\n    str += '</span></a>';\n\n    return str;\n  }\n\n\n  /**\n   * Render the children into the content.\n   * @param {Array} content\n   */\n  _insertContent(content, params) {\n\n    this._currentContent = this._currentContent || [];\n\n    params = params || {};\n\n    let keep;\n    let i = 0;\n    let len;\n\n    // If we've been asked to prepend or append, add the new elements in front,\n    // save the number of old elements we're sliding out, animate,\n    // then clean up.\n    if (this.animate) {\n\n      if (params.prepend) {\n\n        // Get the last elements to keep\n        keep = this._currentContent.slice(-params.prepend);\n        len = keep.length;\n        for (; i < len; i++) {\n          content.push(keep[i]);\n        }\n\n        this.calendarEl.setAttribute('data-prepend-count', len);\n\n        this._animateContent(function() {\n\n          this.calendarEl.removeAttribute('data-prepend-count');\n\n          this._animateContent(function() {\n            content = content.slice(0, -params.prepend);\n            this._insertContent(content);\n          }, this.animationDuration);\n        }, 10);\n      }\n      // Same but appending\n      else if (params.append) {\n\n        // Get the first elements to keep\n        keep = this._currentContent.slice(0, params.append);\n        len = keep.length;\n        for (; i < len; i++) {\n          content.unshift(keep[i]);\n        }\n\n        this.calendarEl.setAttribute('data-append-count', len);\n\n        this._animateContent(function() {\n\n          addClass(this.calendarEl, 'no-animate');\n          content = content.slice(params.append);\n          this._insertContent(content);\n          this.calendarEl.removeAttribute('data-append-count');\n\n          this._animateContent(function() {\n            removeClass(this.calendarEl, 'no-animate');\n          }, 10);\n        }, this.animationDuration);\n      }\n    }\n\n    appendChildren(this.calendarContentEl, this._currentContent = content, true);\n  }\n\n\n  /**\n   * Is a given day selected?\n   * @param {Object} date\n   * @return {Boolean}\n   */\n  _isDaySelected(date) {\n    return this.values && date.equal(this.values);\n  }\n\n\n  /**\n   * Is a given day the start of a range?\n   * @param {Object} date\n   * @return {Boolean}\n   */\n  _isDayRangeStart(date) {\n    return this.inputEls.length > 1 && this.values && date.equal(this.values[0]);\n  }\n\n\n  /**\n   * Is a given day the middle of a range?\n   * @param {Object} date\n   * @return {Boolean}\n   */\n  _isDayRangeMiddle(date) {\n    return this.inputEls.length > 1 && this.values && this.values.length > 1 && date.equal(this.values.slice(1, -1));\n  }\n\n\n  /**\n   * Is a given day the end of a range?\n   * @param {Object} date\n   * @return {Boolean}\n   */\n  _isDayRangeEnd(date) {\n    return this.inputEls.length > 1 && this.values && this.values.length > 1 && date.equal(this.values[this.values.length - 1]);\n  }\n\n\n  /**\n   * Is a given day currently the last\n   * @param {Object} date\n   * @return {Boolean}\n   */\n  _isDayRangeLast(date) {\n\n    let i = this.values.length - 1;\n\n    for (; i > 0; i--) {\n\n      // We have a value and it's not the same as the date.\n      if (this.values[i]) {\n        if (!date.equal(this.values[i])) {\n          return false;\n        }\n        break;\n      }\n    }\n\n    return true;\n  }\n\n\n  /**\n   * Is a given day disabled?\n   * @param {Object} date\n   * @return {Boolean}\n   */\n  _isDayDisabled(date) {\n    return (this.daysDisabled &&\n        this.daysDisabled[date.year] &&\n        this.daysDisabled[date.year][date.month] &&\n        this.daysDisabled[date.year][date.month].indexOf(date.day) !== -1) ||\n      (this.mins[this.activeIndex] && date.before(this.mins[this.activeIndex], true)) ||\n      (this.maxes[this.activeIndex] && date.after(this.maxes[this.activeIndex], true));\n  }\n\n\n  /**\n   * Get any \"info\" for a given day.\n   * @param {Object} date\n   * @return {String}\n   */\n  _getDayInfo(date) {\n    return this.daysInfo && this.daysInfo[date.year] && this.daysInfo[date.year][date.month] && this.daysInfo[date.year][date.month][date.day] ? '<span class=\"spark-calendar__day-note\">' + this.daysInfo[date.year][date.month][date.day] + '</span>' : '';\n  }\n\n\n  /**\n   * Get the class names for a month.\n   * @param {Object} date\n   * @return {String}\n   */\n  _getMonthClassNames(date) {\n\n    let cls = [];\n\n    // Do we have a value in this month?\n    if (date.equalMonth(this.values)) {\n      cls.push('has-value');\n    }\n\n    // Does this month have the start, middle or end of a range?\n    if (this._isRange && this.els.length > 1) {\n\n      let start = date.equalMonth(this.values[0]);\n      let end = date.equalMonth(this.values[this.values.length - 1]);\n      let middle = date.equalMonth(this.values.slice(1, -1));\n      let valBefore = date.afterMonth(this.values);\n      let valAfter = date.beforeMonth(this.values);\n      let afterEnd = this.values[this.values.length - 1] && date.after(this.values[this.values.length - 1]);\n\n      if (start) {\n        cls.push('range-start');\n      }\n      if (end) {\n        cls.push('range-end');\n      }\n      if (middle) {\n        cls.push('range-middle');\n      }\n      if (valBefore) {\n        cls.push('value-before');\n      }\n      if (valAfter) {\n        cls.push('value-after');\n      }\n      if (afterEnd) {\n        cls.push('after-range-end');\n      }\n    }\n\n    return cls.join(' ');\n  }\n\n\n  /**\n   * Create the calendar.\n   */\n  _createCalendar() {\n    let el = document.createElement('div');\n    addClass(el, 'spark-calendar');\n    el.innerHTML = '<nav class=\"spark-calendar__nav\"><button class=\"spark-calendar__previous spark-icon-chevron-left\" title=\"Previous\"></button><button class=\"spark-calendar__next spark-icon-chevron-right\" title=\"Next\"></button></nav><div class=\"spark-calendar__overflow\"><div class=\"spark-calendar__content\"></div></div>';\n    this.calendarEl = el;\n    this.calendarContentEl = el.querySelector('.spark-calendar__content');\n    this.calendarOverflowEl = el.querySelector('.spark-calendar_overflow');\n  }\n\n\n  /**\n   * Create the popover.\n   */\n  _createPopover() {\n\n    this.popover = new Popover(document.createElement('div'), {\n      anchorX: 'center',\n      anchorY: 'bottom',\n      contentEl: this.calendarEl,\n      onClose: this._onPopoverClose.bind(this),\n      onOpen: this._onPopoverOpen.bind(this)\n    });\n  }\n\n\n  /**\n   * Cache elements.\n   */\n  _cacheElements() {\n\n    this.inputEls = [];\n\n    let i = 0;\n    let len = this.els.length;\n    let input;\n\n    for (; i < len; i++) {\n      input = this.els[i].nodeName.toLowerCase() === 'input' ? this.els[i] : this.els[i].querySelector('input[type=\"date\"]');\n      this.inputEls[i] = input;\n    }\n  }\n\n\n  /**\n   * Cache elements specific to the calendar.\n   */\n  _cacheCalendarElements() {\n    this.nextButtonEl = this.calendarEl.querySelector('.spark-calendar__next');\n    this.previousButtonEl = this.calendarEl.querySelector('.spark-calendar__previous');\n  }\n\n\n  /**\n   * Parse parameters from the elements.\n   */\n  _parseParams() {\n\n    this._parseInputElsParams();\n\n    this._isRange = this.els.length > 1 ? true : false;\n    this.autoAdvance = this.autoAdvance !== null ? this.autoAdvance : parseBooleanAttribute(this.els[0], 'data-auto-advance', true);\n    this.autoClose = this.autoClose !== null ? this.autoClose : parseBooleanAttribute(this.els[0], 'data-auto-close', true);\n    this.closeDelay = this.closeDelay !== null ? this.closeDelay : parseNumberAttribute(this.els[0], 'data-close-delay', 500);\n    this.quickJump = this.quickJump !== null ? this.quickJump : parseBooleanAttribute(this.els[0], 'data-quick-jump', false);\n    this.viewRange = this.viewRange !== null ? this.viewRange : parseStringAttribute(this.els[0], 'data-view-range', 'month');\n    this.animate = this.animate !== null ? this.animate : parseBooleanAttribute(this.els[0], 'data-animate', true);\n    this.animationDuration = this.animationDuration !== null ? this.animationDuration : parseNumberAttribute(this.els[0], 'data-animation-duration', 100);\n    this.showOnFocus = this.showOnFocus !== null ? this.showOnFocus : parseBooleanAttribute(this.els[0], 'data-show-on-focus', false);\n  }\n\n\n  /**\n   * Parse the min, max, value and visible counts from the elements if we can.\n   * @return {Number|Boolean}\n   */\n  _parseInputElsParams() {\n\n    let els = this.inputEls;\n\n    if (!els) {\n      return;\n    }\n\n    let i = 0;\n    let len = els.length;\n    let mins = [];\n    let maxes = [];\n    let values = [];\n    let visibleCounts = [];\n    let disableds = [];\n\n    for (; i < len; i++) {\n\n      if (!els[i]) {\n        continue;\n      }\n\n      if (this.mins && this.mins[i])\n        mins[i] = typeof this.mins[i] === 'object' ? this.mins[i] : parsedDomFormat.getValues(this.mins[i]);\n      else if (els[i].getAttribute('min'))\n        mins[i] = parsedDomFormat.getValues(els[i].getAttribute('min'));\n\n      if (this.maxes && this.maxes[i])\n        maxes[i] = typeof this.maxes[i] === 'object' ? this.maxes[i] : parsedDomFormat.getValues(this.maxes[i]);\n      else if (els[i].getAttribute('max'))\n        maxes[i] = parsedDomFormat.getValues(els[i].getAttribute('max'));\n\n      if (this.values && this.values[i])\n        values[i] = typeof this.values[i] === 'object' ? this.values[i] : parsedDomFormat.getValues(this.values[i]);\n      else if (els[i].value)\n        values[i] = parsedDomFormat.getValues(els[i].value);\n\n      disableds[i] = parseBooleanAttribute(els[i], 'disabled', false);\n\n      if (!this.visibleCounts)\n        visibleCounts[i] = parseInt(els[i].getAttribute('data-visible-count'), 10) || 1;\n    }\n\n    this.mins = mins;\n    this.minVisible = dateHelper.earliest(mins);\n    this.maxes = maxes;\n    this.maxVisible = dateHelper.latest(maxes);\n    this.values = values;\n    this._isDisabled = disableds;\n    if (visibleCounts.length) this.visibleCounts = visibleCounts;\n  }\n\n\n  /**\n   * Get the dates we should be showing. Start with the first value or today's date.\n   */\n  _initDatesToShow() {\n\n    let arr = [];\n    let i = 0;\n    let len = this.values.length;\n\n    // Get the date for the current index\n    if (this.values[this.activeIndex]) {\n      arr.push(this.values[this.activeIndex].clone());\n    }\n\n    // Get the first date\n    for (; i < len && !arr.length; i++) {\n      if (this.values[i]) {\n        arr.push(this.values[i].clone());\n      }\n    }\n\n    // If we didn't get a date, use the min\n    for (i = 0, len = this.mins.length; i < len && !arr.length; i++) {\n      if (this.mins[i]) {\n        arr.push(this.mins[i].clone());\n      }\n    }\n\n    // If we still didn't get a date, add today's date.\n    if (!arr.length) {\n      arr.push(dateHelper.now());\n    }\n\n    this._datesToShow = arr;\n\n    this._setDatesToShow();\n  }\n\n\n  /**\n   * Set the dates to show.\n   * @param {Number} change Optional The direction to change\n   */\n  _setDatesToShow(change) {\n\n    let arr = this._datesToShow;\n    let visibleCount = this._currentBreakpoint === 'xs' || this._currentBreakpoint === 'sm' ? 1 : (this.visibleCounts[this.activeIndex] || this.visibleCounts[0] || 1);\n    let i = 0;\n    let noun = this.viewRange.charAt(0).toUpperCase() + this.viewRange.slice(1);\n\n    // If we have more dates to show than we're supposed to show, remove the excess.\n    // This happens when visible count changes between renders\n    if (arr.length > visibleCount) {\n      arr.splice(visibleCount);\n    }\n\n    // If we are incrementing or decrementing the starting month\n    if (change) {\n\n      // Empty the rest of the dates from the array\n      arr = this._datesToShow = arr.splice(0, 1);\n\n      // Decrement\n      if (change < 0) {\n        for (; i > change; i--) {\n          arr[0] = arr[0]['previous' + noun];\n        }\n      } else {\n        for (; i < change; i++) {\n          arr[0] = arr[0]['next' + noun];\n        }\n      }\n    }\n\n    // Check bounds\n    this._atMin = this._checkMinDateVisible(noun, arr);\n    this._atMax = this._checkMaxDateVisible(noun, arr);\n\n    let addDate;\n    let lastSelected;\n    let action;\n    i = 0;\n\n    // Add additional dates\n    while (arr.length < visibleCount) {\n\n      // If at the max, prepend\n      // If we're in the last input and it has a value and it's a different month than the first value, prepend\n      // If at the min, append\n      // If an item we're adding is before the min, discard it and append an item after the last in the arr\n      // If an item we're adding is after the max, discard it and prepend an item before the first in the arr\n\n      lastSelected = !change &&\n        this.activeIndex === this.values.length - 1 &&\n        this.values[this.values.length - 1] &&\n        this.values[0] &&\n        !this.values[this.values.length - 1]['equal' + noun](this.values, true);\n\n      // If we're showing the max date or we have the last input selected and it has a value, add dates before.\n      if (this._atMax || lastSelected) {\n\n        addDate = arr[i]['previous' + noun];\n        action = 'unshift';\n\n        if (addDate['before' + noun](this.minVisible)) {\n          addDate = arr[i]['next' + noun];\n          action = 'push';\n        }\n      } else {\n\n        addDate = arr[i]['next' + noun];\n        action = 'push';\n\n        if (addDate['after' + noun](this.maxVisible)) {\n          addDate = arr[i]['previous' + noun];\n          action = 'unshift';\n        }\n      }\n\n      if (action === 'push') {\n        arr.push(addDate);\n        i = arr.length - 1;\n      } else {\n        arr.unshift(addDate);\n        i = 0;\n      }\n    }\n\n    // Check bounds again\n    this._atMin = this._checkMinDateVisible(noun, arr);\n    this._atMax = this._checkMaxDateVisible(noun, arr);\n\n    // Update the navigation to reflect the _atMin or _atMax state\n    this._updateNav();\n  }\n\n\n  /**\n   * Check for the min value in an array of values.\n   * @param {Object} min\n   * @param {String} noun The type of date to check\n   * @param {Array} arr\n   * @return {Boolean}\n   */\n  _checkMinDateVisible(noun, arr) {\n\n    if (!this.minVisible) {\n      return;\n    }\n\n    let min = this.minVisible;\n\n    if (min && (arr[0]['equal' + noun](min) || arr[0]['before' + noun](min))) {\n      arr[0] = min;\n      return true;\n    }\n\n    return false;\n  }\n\n\n  /**\n   * Check for the max value in an array of values.\n   * @param {Object} max\n   * @param {String} noun The type of date to check\n   * @param {Array} arr\n   * @return {Boolean}\n   */\n  _checkMaxDateVisible(noun, arr) {\n\n    if (!this.maxVisible) {\n      return;\n    }\n\n    let max = this.maxVisible;\n\n    if (max && arr[arr.length - 1] && (arr[arr.length - 1]['equal' + noun](max) || arr[arr.length - 1]['after' + noun](max))) {\n      arr[arr.length - 1] = max;\n      return true;\n    }\n\n    return false;\n  }\n\n\n  /**\n   * Check that the values are in bounds and, optinoally, in sequential order.\n   * If checking for sequence, remove those which aren't.\n   * @param {Number} setIndex The index of the value most recently set. This shouldn't be removed.\n   * @return {Boolean} Did any values change?\n   */\n  _checkValues(setIndex, skipRangeCheck) {\n\n    // Check boundaries\n    let changed = this._checkMinMaxValues();\n\n    // Sequential range items check\n    if (this._isRange && !skipRangeCheck) {\n\n      let i = this.values.length - 1;\n\n      for (; i >= 0; i--) {\n        if (this.values[i] && this.values[i - 1] && this.values[i].beforeDay(this.values[i - 1], true)) {\n          if (i === setIndex) {\n            this.setValue(null, i - 1, true);\n          } else {\n            this.setValue(null, i, true);\n          }\n          changed = true;\n        }\n      }\n    }\n\n    return changed;\n  }\n\n\n  /**\n   * Check minimum/maximum values.\n   * @return {Boolean}\n   */\n  _checkMinMaxValues() {\n\n    let i = 0;\n    let len = this.values.length;\n    let changed = false;\n\n    for (; i < len; i++) {\n      if ((this.maxes && this.maxes[i] && this.values[i] && this.values[i].after(this.maxes[i], true))) {\n        this.values[i] = this.maxes[i].clone();\n        changed = true;\n      } else if ((this.mins && this.mins[i] && this.values[i] && this.values[i].before(this.mins[i], true))) {\n        this.values[i] = this.mins[i].clone();\n        changed = true;\n      }\n    }\n\n    return changed;\n  }\n\n\n  /**\n   * Enqueue animations to be run. (Not really animations since those happen w/ CSS. More\n   * of a manager of timeouts).\n   * @param {Function} cb\n   * @param {Number} duration\n   */\n  _animateContent(cb, duration) {\n    this._animationQueue = this._animationQueue || [];\n    this._animationQueue.push({\n      cb: cb,\n      d: duration\n    });\n    this._runAnimation();\n  }\n\n\n  /**\n   * Run the first queued animation. When complete, run the next animation.\n   */\n  _runAnimation() {\n\n    if (!this._animationTimer) {\n\n      let a = this._animationQueue.shift();\n\n      if (a) {\n\n        this._animationTimer = setTimeout(function() {\n          a.cb.call(this);\n          this._animationTimer = null;\n          this._runAnimation();\n        }.bind(this), a.d);\n      }\n    }\n  }\n\n\n  /**\n   * Update attributes on the element and its children.\n   */\n  _updateAttributes() {\n    this.calendarEl.setAttribute('data-visible-count', this._currentBreakpoint === 'xs' ? 1 : (this.visibleCounts[this.activeIndex] || this.visibleCounts[0] || 1));\n    this._updateNav();\n  }\n\n\n  /**\n   * Update the navigation to reflect the ability to move forward and backward.\n   */\n  _updateNav() {\n\n    if (this.previousButtonEl) {\n      if (this._atMin)\n        this.previousButtonEl.setAttribute('disabled', true);\n      else\n        this.previousButtonEl.removeAttribute('disabled');\n    }\n\n    if (this.nextButtonEl) {\n      if (this._atMax)\n        this.nextButtonEl.setAttribute('disabled', true);\n      else\n        this.nextButtonEl.removeAttribute('disabled');\n    }\n  }\n\n\n  /**\n   * Create bound versions of event listener callbacks and store them.\n   * Otherwise we can't unbind from these events later because the\n   * function signatures won't match.\n   */\n  _bindEventListenerCallbacks() {\n\n    this._onInputChangeBound = this._onInputChange.bind(this);\n    this._onSelectChangeBound = this._onSelectChange.bind(this);\n    this._onInputFocusBound = this._onInputFocus.bind(this);\n    this._onClickBound = this._onClick.bind(this);\n    this._onCalendarClickBound = this._onCalendarClick.bind(this);\n\n    this._onCalendarMouseOverBound = this._onCalendarMouseOver.bind(this);\n    this._onCalendarMouseOutBound = this._onCalendarMouseOut.bind(this);\n\n    this._onResizeBound = this._onResize.bind(this);\n  }\n\n\n  /**\n   * Add event listeners for DOM events.\n   */\n  _addEventListeners() {\n\n    let i = 0;\n    let len = this.els.length;\n\n    for (; i < len; i++) {\n      this.els[i].addEventListener('click', this._onClickBound);\n      this.inputEls[i].addEventListener('change', this._onInputChangeBound);\n      this.inputEls[i].addEventListener('focus', this._onInputFocusBound);\n    }\n\n    this.calendarEl.addEventListener('mouseover', this._onCalendarMouseOverBound);\n    this.calendarEl.addEventListener('mouseout', this._onCalendarMouseOutBound);\n    this.calendarEl.addEventListener('click', this._onCalendarClickBound);\n\n    this.calendarEl.addEventListener('change', this._onSelectChangeBound);\n\n    window.addEventListener('resize', this._onResizeBound);\n    window.addEventListener('orientationchange', this._onResizeBound);\n  }\n\n\n  /**\n   * Remove event listeners for DOM events..\n   */\n  _removeEventListeners() {\n\n    let i = 0;\n    let len = this.els.length;\n\n    for (; i < len; i++) {\n      this.els[i].removeEventListener('click', this._onClickBound);\n      this.inputEls[i].removeEventListener('change', this._onInputChangeBound);\n      this.inputEls[i].removeEventListener('focus', this._onInputFocusBound);\n    }\n\n    this.calendarEl.removeEventListener('mouseover', this._onCalendarMouseOverBound);\n    this.calendarEl.removeEventListener('mouseout', this._onCalendarMouseOutBound);\n    this.calendarEl.removeEventListener('click', this._onCalendarClickBound);\n\n    this.calendarEl.removeEventListener('change', this._onSelectChangeBound);\n\n    window.removeEventListener('resize', this._onResizeBound);\n    window.removeEventListener('orientationchange', this._onResizeBound);\n  }\n\n\n  /**\n   * Focus on the next input if there is one.\n   */\n  _focusNext() {\n\n    let index;\n\n    // If we don't have any null values, don't do anything.\n    if ((index = this.values.indexOf(null)) === -1) {\n      return;\n    }\n\n    if (this.activeIndex < this.els.length - 1) {\n      this.open(this.activeIndex + 1);\n    } else {\n      this.open(index);\n    }\n  }\n\n\n  /**\n   * Close if we're on the last input and we have values.\n   */\n  _closeOnLast() {\n    if (this.values.indexOf(null) === -1) {\n      this.close({\n        delay: this.closeDelay\n      });\n    }\n  }\n\n\n  /**\n   * Make the toggle icon a fill icon.\n   */\n  _fillToggle() {\n\n    let toggle;\n\n    if (this.els[this.activeIndex] && (toggle = this.els[this.activeIndex].querySelector('.spark-date__calendar-toggle [class*=\"spark-icon\"]'))) {\n      addClass(toggle, 'spark-icon--fill');\n    }\n  }\n\n\n  /**\n   * Make the toggle icon a line icon.\n   */\n  _unfillToggle() {\n\n    let toggle;\n\n    if (this.els[this.activeIndex] && (toggle = this.els[this.activeIndex].querySelector('.spark-date__calendar-toggle [class*=\"spark-icon\"]'))) {\n      removeClass(toggle, 'spark-icon--fill');\n    }\n  }\n\n\n  /**\n   * Activate the element associated with the calendar.\n   * @param {Number} index\n   */\n  _activateElement(index) {\n    let el = this.els[index];\n    if (el) addClass(el, 'active');\n  }\n\n\n  /**\n   * Deactivate the element associated with the calendar.\n   * @param {Number} index\n   */\n  _deactivateElement(index) {\n    let el = this.els[index];\n    if (el && !this.values[index] && !hasClass(el, 'focus') && !hasClass(el, 'has-partial-value')) {\n      removeClass(el, 'active');\n    }\n  }\n\n\n  /**\n   * Check the size of the popover and see if we should be showing the XS treatment.\n   */\n  _checkSize() {\n\n    let bp = getBreakpoint(window.outerWidth);\n\n    // Don't do anything if the breakpoint hasn't changed.\n    if (this._currentBreakpoint === bp) return;\n\n    // Store the breakpoint\n    this._currentBreakpoint = bp;\n\n    // Re-render the date range\n    this._setDatesToShow();\n    this.render(true);\n    this.popover.update();\n  }\n\n\n  /**\n   * Scroll the active input element into view.\n   */\n  _scrollToInput() {\n    let el = this.els[this.activeIndex];\n    if (el) scrollWindowTo(el);\n  }\n\n\n  /**\n   * Update the hover classes.\n   * @param {Element} hoverStarts\n   * @param {Element} hoverEnds\n   */\n  _updateHoverClasses(hoverStarts, hoverEnds) {\n\n    this._hoverStarts = this._hoverStarts || [];\n    this._hoverEnds = this._hoverEnds || [];\n\n    hoverStarts = hoverStarts instanceof Array ? hoverStarts : (hoverStarts ? [hoverStarts] : []);\n    hoverEnds = hoverEnds instanceof Array ? hoverEnds : (hoverEnds ? [hoverEnds] : []);\n\n    let allStarts = [];\n    let curStarts = [];\n    let newStarts = [];\n    let allEnds = [];\n    let curEnds = [];\n    let newEnds = [];\n\n    hoverStarts.forEach(function(el) {\n\n      let index = this._hoverStarts.indexOf(el);\n\n      // Already hovered.\n      if (index !== -1) {\n        curStarts.push(el);\n      }\n      // Not already hovered. Ready to add the class.\n      else if (el) {\n        newStarts.push(el);\n        addClass(el, 'hover-start');\n      }\n    }, this);\n\n    allStarts = Array.prototype.concat.call([], curStarts, newStarts);\n\n    this._hoverStarts.forEach(function(el) {\n      if (allStarts.indexOf(el) === -1) {\n        removeClass(el, 'hover-start');\n      }\n    }, this);\n\n\n    hoverEnds.forEach(function(el) {\n\n      let index = this._hoverEnds.indexOf(el);\n\n      // Already hovered.\n      if (index !== -1) {\n        curEnds.push(el);\n      }\n      // Not already hovered. Ready to add the class.\n      else if (el) {\n        newEnds.push(el);\n        addClass(el, 'hover-end');\n      }\n    }, this);\n\n    allEnds = Array.prototype.concat.call([], curEnds, newEnds);\n\n    this._hoverEnds.forEach(function(el) {\n      if (allEnds.indexOf(el) === -1) {\n        removeClass(el, 'hover-end');\n      }\n    }, this);\n\n    this._hoverStarts = allStarts;\n    this._hoverEnds = allEnds;\n  }\n\n\n  /**\n   * When an element is clicked, if the toggle was the target, open the popover.\n   * @param {Object} e\n   */\n  _onClick(e) {\n\n    if (getParent(e.target, '.spark-date__calendar-toggle', this.els)) {\n\n      let el = getParent(e.target, '.spark-date', this.els);\n      let index = this.els.indexOf(el);\n\n      e.preventDefault();\n\n      // Open on the next tick. Otherwise we also receive the window click close event.\n      this.open(index, {\n        delay: 1\n      });\n    }\n  }\n\n\n  /**\n   * When the calendar is hovered, do some highlighting if we're showing a range.\n   * @param {Object} e\n   */\n  _onCalendarMouseOver(e) {\n    if (this.viewRange === 'month')\n      this._onCalendarMouseOverMonths(e.target);\n  }\n\n\n  /**\n   * Set hover states for days.\n   * @param  {Element} target\n   */\n  _onCalendarMouseOverMonths(target) {\n\n    if (!this._isRange) {\n      return;\n    }\n\n    let day = getParent(target, '.spark-calendar__day');\n\n    if (!day) {\n      this._updateHoverClasses();\n      return;\n    }\n\n    let month = getParent(target, '.spark-calendar__month');\n    let mHasClass = function(c) {\n      return hasClass(month, c);\n    }.bind(this);\n    let newStart = [];\n    let newEnd = [];\n    let daySel;\n\n    // Only do highlights if we don't already have a value for this index.\n    if (!this.values[this.activeIndex]) {\n\n      // A month with a value before it but no value of its own, hover starts\n      // from the first day to the hovered day.\n      if (mHasClass('value-before') && !mHasClass('after-range-end') && !mHasClass('has-value') && !mHasClass('value-after')) {\n\n        newStart.push(month.querySelector('.spark-calendar__day:not(.spark-calendar__day--inactive):not(.spark-calendar__day--disabled)'));\n        newEnd.push(day);\n\n        // Add a hover range to a previous month.\n        let prevMonth = month;\n        while ((prevMonth = getSiblingBefore(prevMonth, '.spark-calendar__month')) && !hasClass(prevMonth, 'value-after') && (hasClass(prevMonth, 'has-value') || hasClass(prevMonth, 'value-before'))) {\n\n          daySel = prevMonth.querySelectorAll('.spark-calendar__day--selected');\n          daySel = daySel[daySel.length - 1];\n          daySel = daySel || prevMonth.querySelector('.spark-calendar__day');\n\n          if (daySel) {\n            newStart.push(daySel);\n            daySel = prevMonth.querySelectorAll('.spark-calendar__day');\n            daySel = daySel[daySel.length - 1];\n            newEnd.push(daySel);\n          }\n        }\n      }\n      // A month with a value, highlight either from the hovered day to\n      // the selection or from the selection to the day.\n      else if (mHasClass('has-value') && !mHasClass('value-before') && !mHasClass('value-after') && ((newStart = getSiblingBefore(day, '.spark-calendar__day--selected')) || (newEnd = getSiblingAfter(day, '.spark-calendar__day--selected')))) {\n\n        if (newStart) {\n          newStart = [newStart];\n          newEnd = [day];\n        } else {\n          newEnd = [newEnd];\n          newStart = [day];\n        }\n\n        if (hasClass(newEnd[0], 'spark-calendar__range-start') || hasClass(newStart[0], 'spark-calendar__range-end')) {\n          newStart = [];\n          newEnd = [];\n        }\n      }\n      // A month with a middle range should highlight before\n      else if (mHasClass('has-value') && mHasClass('range-middle') && mHasClass('value-before')) {\n        daySel = getSiblingBefore(day, '.spark-calendar__day--selected');\n        if (daySel) {\n          newStart = [daySel];\n          newEnd = [day];\n        }\n      }\n    }\n\n    this._updateHoverClasses(newStart, newEnd);\n  }\n\n\n  /**\n   * When the calendar is hovered, undo some highlighting if we're showing a range.\n   * @param {Object} e\n   */\n  _onCalendarMouseOut(e) {\n    if (this.viewRange === 'month')\n      this._onCalendarMouseOutMonths(e.target);\n  }\n\n\n  /**\n   * Clear hover states for days.\n   * @param  {Element} target\n   */\n  _onCalendarMouseOutMonths(target) {\n\n    let day = getParent(target, '.spark-calendar__day');\n    let days = getParent(target, '.spark-calendar__days');\n    let month = getParent(target, '.spark-calendar__month');\n\n    removeClass(day, 'hover');\n    removeClass(days, 'hover');\n    removeClass(month, 'hover');\n    removeClass(this.calendarEl, 'hover');\n  }\n\n\n  /**\n   * When the calendar is clicked, handle navigation clicks and date selections.\n   * @param {Object} e\n   */\n  _onCalendarClick(e) {\n\n    let nav = getParent(e.target, '.spark-calendar__nav', this.calendarEl);\n    let day;\n    let dir;\n\n    // Navigation clicks\n    if (nav) {\n\n      // Previous\n      if (getParent(e.target, '.spark-calendar__previous', nav)) {\n        this.previous();\n      }\n      // Next\n      else if (getParent(e.target, '.spark-calendar__next', nav)) {\n        this.next();\n      }\n    }\n    // Day click\n    else if ((day = getParent(e.target, '.spark-calendar__day'))) {\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Disabled day moves can move us to the next month\n      if (hasClass(day, 'spark-calendar__day--disabled')) {\n        dir = day.getAttribute('data-direction');\n        if (dir === 'next') this.next();\n        else if (dir === 'previous') this.previous();\n      }\n      // Enabled day sets the value\n      else {\n        this.setValue(day.getAttribute('data-date'), this.activeIndex);\n        if (this.autoAdvance) this._focusNext();\n        if (this.autoClose) this._closeOnLast();\n      }\n    }\n  }\n\n\n  /**\n   * When the popover opens, set the toggle state.\n   */\n  _onPopoverOpen() {\n    this._fillToggle();\n    this._checkSize();\n    if (this._currentBreakpoint === 'xs') this._scrollToInput();\n  }\n\n\n  /**\n   * When the popover closes, reset the active state.\n   */\n  _onPopoverClose() {\n    this._unfillToggle();\n    this._updateHoverClasses();\n    this._deactivateElement(this.activeIndex);\n    this.activeIndex = null;\n  }\n\n\n  /**\n   * When the input that corresponds to this instance changes. Allows us to listen\n   * and respond to changes made by other components (Calendar Popover, for example).\n   * @param {Object} e\n   */\n  _onInputChange(e) {\n\n    let index = this.inputEls.indexOf(e.target);\n\n    if (this._inputsChanging && this._inputsChanging.indexOf(index) !== -1)\n      return;\n\n    this.setValue(e.target.value, index);\n  }\n\n\n  /**\n   * When an input receives focus, if we are supposed to automatically show\n   * on focus do so.\n   * @param {Object} e\n   */\n  _onInputFocus(e) {\n    if (!this.showOnFocus) return;\n    let index = this.inputEls.indexOf(e.target);\n    if (index !== -1) this.open(index);\n  }\n\n\n  /**\n   * When one of the calendar quick jump select inputs changes.\n   * We have to set the value of the select input back to its original\n   * value or else it will be out of sync when the currently active\n   * month is shown again.\n   * @param {Object} e\n   */\n  _onSelectChange(e) {\n\n    let name = e.target.name;\n    let val = e.target.value;\n    let curVal = this._datesToShow[this.activeIndex][name];\n    let obj = {};\n\n    obj[name] = val;\n    this.showDate(obj);\n    e.target.value = curVal;\n  }\n\n\n  /**\n   * When the window resizes, determine if we're at the XS breakpoint so we\n   * can do some mobile-esque stuff!\n   * @param {Object} e\n   */\n  _onResize() {\n    if (this.activeIndex !== null) this._checkSize();\n  }\n}\n\n\n/**\n * Whitelisted parameters which can be set on construction.\n * @type {Array}\n */\nCalendarPopover.prototype._whitelistedParams = [\n  'els', 'visibleCounts', 'autoAdvance', 'autoClose',\n  'closeDelay', 'mins', 'maxes', 'values', 'daysDisabled', 'daysInfo',\n  'quickJump', 'quickJumpRange', 'calendarEl', 'viewRange', 'animate', 'animationDuration',\n  'showOnFocus', 'onChange'\n];\n\n\n/**\n * Default values for internal properties we will be setting.\n * These are set on each construction so we don't leak properties\n * into the prototype chain.\n * @type {Object}\n */\nCalendarPopover.prototype.defaults = {\n  els: null,\n  inputEls: null,\n  calendarEl: null,\n  calendarContentEl: null,\n  calendarOverflowEl: null,\n  visibleCounts: null,\n  activeIndex: null,\n  mins: null,\n  minVisible: null,\n  maxes: null,\n  maxVisible: null,\n  values: null,\n  daysDisabled: null,\n  daysInfo: null,\n  viewRange: null,\n  autoAdvance: null,\n  autoClose: null,\n  quickJump: null,\n  closeDelay: null,\n  nextButtonEl: null,\n  previousButtonEl: null,\n  animate: null,\n  animationDuration: null,\n  showOnFocus: null,\n  onChange: null,\n  _isDisabled: false,\n  _isRange: null,\n  _hoverStarts: null,\n  _hoverEnds: null,\n  _currentBreakpoint: null,\n  _animationQueue: null,\n  _currentContent: null,\n  _datesToShow: null,\n  _monthsShowing: null,\n  _atMin: false,\n  _atMax: false,\n  _inputsChanging: false,\n  _openCloseTimer: null,\n  _renderCache: null,\n  _onClickBound: null,\n  _onCalendarMouseOverBound: null,\n  _onCalendarMouseOutBound: null,\n  _onCalendarClickBound: null,\n  _onSelectChangeBound: null,\n  _onInputChangeBound: null,\n  _onInputFocusBound: null,\n  _onResizeBound: null\n};\n\nexport default CalendarPopover;\n"]}